<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="server" />
	<meta name="description" content="server" />
	<!-- 网页标签标题 -->
	<title>server</title>
	<link rel="shortcut icon" href="/img/docsite.ico"/>
	<link rel="stylesheet" href="/build/blogDetail.css" />
</head>
<body>
	<div id="root"><div class="blog-detail-page" data-reactroot="" data-reactid="1" data-react-checksum="82446864"><header class="header-container header-container-normal" data-reactid="2"><div class="header-body" data-reactid="3"><a href="/zh-cn/blog" data-reactid="4"><img class="logo" src="http://nosdn-yx.127.net/yxgame/6dfac650089849dc8281ffef5e164127.png" data-reactid="5"/></a><div class="header-menu" data-reactid="6"><img class="header-menu-toggle" src="/img/system/menu_gray.png" data-reactid="7"/></div></div></header><section class="blog-content markdown-body" data-reactid="8"><h1>云游戏渠道应用接入文档</h1>
<h2>文档版本更新记录</h2>
<table>
<thead>
<tr>
<th>编号</th>
<th>修改描述</th>
<th>修订日期</th>
<th>版本号</th>
<th>修订人</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>创建文档</td>
<td>20180427</td>
<td>1.0</td>
<td>胡世长</td>
</tr>
<tr>
<td>2</td>
<td>修改文档，加入自动同步注册和红点同步及游戏中心的免登</td>
<td>20180522</td>
<td>1.1</td>
<td>胡世长</td>
</tr>
<tr>
<td>3</td>
<td>修改文档，同步bima-oauth2的所有接口</td>
<td>20181011</td>
<td>1.2</td>
<td>何慧</td>
</tr>
</tbody>
</table>
<h2>渠道应用授权登陆流程及接入注意事项</h2>
<h3>下载</h3>
<p><a href="http://nosdn-yx.127.net/yxgame/8a49e813671570e601671588cd5f0002.zip">Demo</a></p>
<h3>授权流程图</h3>
<p><img src="http://nosdn-yx.127.net/yxgame/417bf23c05f64116b0ed079e2a616ddc.png" alt="授权流程图"></p>
<h3>角色说明</h3>
<ul>
<li>
<p><code>GAME</code>:接入云游戏的游戏方(例如第五人格)</p>
</li>
<li>
<p><code>WebView</code>: 接入渠道方的游戏中心Webview</p>
<p><code>GAME</code>与<code>Webview</code>都属于游戏中心的子应用</p>
</li>
<li>
<p><code>App</code>:接入云游戏的渠道方的App</p>
</li>
<li>
<p><code>AppServer</code>:接入云游戏的渠道方的Server</p>
</li>
<li>
<p><code>GameCenterServer</code>:云游戏的服务端</p>
</li>
</ul>
<h3>oauth流程中的术语说明</h3>
<ul>
<li><code>appid</code>:接入授权的一个企业或者接入方</li>
<li><code>appSecret</code>:接入授权的接入方获取的appId对应的secret</li>
<li><code>clientId</code>:接入方在<code>appId</code>下生成的子应用</li>
<li><code>clientSecret</code>:接入方在<code>appId</code>下生成的子应用的secret</li>
<li><code>openId</code>:接入方在<code>appId</code>下的用户标识，关于<code>appId</code>唯一</li>
<li><code>code</code>:oauth第一步需要先获取一个过期时间较短的临时授权码，如微信是5分钟</li>
<li><code>accessToken</code>:oauth授权成功后拿到的用来鉴权的token信息，关于<code>clientId</code>和系统的<code>userId</code>唯一</li>
</ul>
<h3>接入重要注意事项</h3>
<ol>
<li>接入并开启渠道授权后，需要第一时间联系运营在后台进行配置以下内容
<ul>
<li><code>oauthAppId</code>和<code>oauthAppSecret</code>:渠道方分配给云游戏进行Oauth接入分配的<code>appId</code>和<code>secret</code>, 后续所有给云游戏分配的<code>clientId</code>都需要在这个<code>appId</code>的维度下，即同一用户使用同一个<code>appId</code>下不同的<code>clientId</code>授权，获取的<code>openId</code>是相同的。注意**<font color=red>这很关键</font>**，否则不同游戏映射出来的账号是不同的</li>
<li><code>webClientId</code>和<code>webClientSecret</code>:渠道方在上方<code>oauthAppId</code>下给云游戏中心webview分配的<code>clientId</code>，在渠道的App内也会用到，渠道App进入游戏中心的时候需要获取code并作为参数附到链接后，后文会提到。</li>
<li>提供的自动注册<code>ClientId</code>的接口，需要保证在前面的<code>oauthAppId</code>维度下进行。</li>
<li>授权流程中的<code>code</code>换完一次<code>accessToken</code>后需要失效</li>
<li>生成<code>accessToken</code>时，需要同时关联<code>clientId</code>与<code>userId</code>两个维度，即同一个用户在不同的<code>clientId</code>下获取到的<code>accessToken</code>是不同，并可以同时存在和使用，互不影响</li>
<li>按照后文的各个必须的服务端接口，到后台配置接口url</li>
</ul>
</li>
</ol>
<h2>服务端接口说明</h2>
<p><strong><font color=red>必须严格按照接口定义实现并将URL配置到后台</font></strong></p>
<h3>通用请求参数及签名</h3>
<table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">appid</td>
<td style="text-align:left">接入应用id</td>
</tr>
<tr>
<td style="text-align:left">timestamp</td>
<td style="text-align:left">unix时间戳(ms)</td>
</tr>
<tr>
<td style="text-align:left">sign</td>
<td style="text-align:left">签名</td>
</tr>
</tbody>
</table>
<h4>签名算法</h4>
<ol>
<li>将url路径中的参数对，以参数名按字母序排列(不包含sign参数本身)</li>
<li>排好的顺序基础上，将对应的参数值进行拼接(没有拼接符)</li>
<li>将签名密钥（从后台拿到的GameCenterServer生成的私钥appSecret)加在拼接好的字符串头部</li>
<li>对字符串进行sha1签名</li>
<li>将sign参数加到url</li>
</ol>
<h5>示例</h5>
<pre><code>appsecret=key
appid=av
timestamp=1512970730186
p1=b1
p2=a2

CheckSum=sha1hex(keyavb1a21512970730186)=9040814fffef8b6367c71ff1748d4af56437308e 
</code></pre>
<ul>
<li>有特别说明不需要携带签名的API,按接口说明要求调用即可。</li>
<li>没有特别说明不需要签名校验的均需要携带以下参数
<ul>
<li>appid</li>
<li>timestamp</li>
<li>sign</li>
</ul>
</li>
</ul>
<h3>1、GameCenterServer自动向AppServer注册Game</h3>
<p><code>/api/v1/oauth2/app/client/add</code></p>
<ul>
<li>提供方:AppServer</li>
<li>调用方:GameCenterServer</li>
<li>请求方式:<code>POST</code></li>
<li>header:<code>content-type:application/json</code></li>
<li>请求参数格式:<code>json</code></li>
<li>返回数据格式:<code>json</code></li>
<li>此接口不需要签名</li>
</ul>
<h4>请求参数说明</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>appId</td>
<td>分配的oauthAppId,所有云游戏ClientId及webClientid属于这个oauthAppId</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>appSecret</td>
<td>分配oauthAppSecret</td>
<td>String</td>
<td>是</td>
</tr>
</tbody>
</table>
<h4>请求示例</h4>
<pre><code>{
    &quot;appId&quot;:&quot;defte234213434354534&quot;,
    &quot;appSecret&quot;:&quot;12335435646546fdgser&quot;
}
</code></pre>
<h4>返回数据说明</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码，成功code是200，失败是除成功200以外的值</td>
<td>int</td>
<td>是</td>
</tr>
<tr>
<td>msg</td>
<td>提示信息，成功是ok，失败是具体的错误提示</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>result</td>
<td>返回数据，正确的情况下包括clientId和clientSecret字段</td>
<td>Object</td>
<td>是</td>
</tr>
<tr>
<td>clientId</td>
<td>oauth分配的clientId</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>clientSecret</td>
<td>oauth分配的clientSecret</td>
<td>String</td>
<td>是</td>
</tr>
</tbody>
</table>
<h4>返回示例</h4>
<pre><code>{
    &quot;code&quot;:&quot;200&quot;,
    &quot;msg&quot;:&quot;ok&quot;,
    &quot;result&quot;:{
    	&quot;clientId&quot;:&quot;123dsfweari2u34298fjedeiwj&quot;,
	  &quot;clientSecret&quot;:&quot;defefikjsdknv9e2934jife==&quot;
    }
}
</code></pre>
<h3>2、GameCenterServer同步红点给AppServer</h3>
<p><code>/api/v1/open/redDot/config</code></p>
<ul>
<li>提供方:AppServer</li>
<li>调用方:GameCenterServer</li>
<li>请求方式:<code>POST</code></li>
<li>header:<code>content-type:application/json</code></li>
<li>请求参数格式:<code>json</code></li>
<li>返回数据格式:<code>json</code></li>
</ul>
<h4>请求路径参数</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>appid</td>
<td>应用id</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>timestamp</td>
<td>时间戳</td>
<td>Long</td>
<td>是</td>
</tr>
<tr>
<td>sign</td>
<td>签名，签名校验方式见签名算法</td>
<td>String</td>
<td>是</td>
</tr>
</tbody>
</table>
<h4>请求参数说明</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>redDotSwitch</td>
<td>红点开关，true表示开启不开启就就不显示红点数据</td>
<td>boolean</td>
<td>是</td>
</tr>
<tr>
<td>os</td>
<td>操作系统，android和ios</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>context</td>
<td>红点文案</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>icon</td>
<td>红点图片</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>effectiveTime</td>
<td>有效开始时间</td>
<td>Long</td>
<td>是</td>
</tr>
<tr>
<td>expirationTime</td>
<td>有效结束时间</td>
<td>Long</td>
<td>是</td>
</tr>
</tbody>
</table>
<h4>请求示例</h4>
<pre><code>https://xxxxxxx/api/v1/oauth2/user/info?appid=APPID&amp;timestamp=TIMESTAMP
</code></pre>
<pre><code>{
    &quot;redDotSwitch&quot;:true,
    &quot;os&quot;:&quot;ios&quot;,
    &quot;context&quot;:&quot;有一个新游戏&quot;,
    &quot;icon&quot;:&quot;http://一个图片.png&quot;,
    &quot;effectiveTime&quot;:1538211191233,
    &quot;expirationTime&quot;:1538211191233
}
</code></pre>
<h4>返回数据说明</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码，成功code是200，失败是除成功200以外的值</td>
<td>int</td>
<td>是</td>
</tr>
<tr>
<td>msg</td>
<td>提示信息，成功是ok，失败是具体的错误提示</td>
<td>String</td>
<td>是</td>
</tr>
</tbody>
</table>
<h4>请求示例</h4>
<pre><code>{
    &quot;code&quot;:&quot;200&quot;,
    &quot;msg&quot;:&quot;ok&quot;
}
</code></pre>
<h3>3、请求code</h3>
<p><code>/api/v1/oauth2/code</code></p>
<p>游戏中心WebView/Game 使用AppServer发放的appid请求对应的临时code.</p>
<ul>
<li>提供方:AppServer</li>
<li>调用方:App客户端应用</li>
<li>请求方式:<code>GET</code></li>
<li>返回数据格式:<code>json</code></li>
</ul>
<p>注意，如果是 Web 应用对应的 redirect_uri 有对应的域名限制（需要实现），必须跳转到后台登记的域名下的 url 地址。</p>
<h4>参数说明</h4>
<h5>Url参数</h5>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>appid</td>
<td>biamServer应用id</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>timestamp</td>
<td>时间戳</td>
<td>Long</td>
<td>是</td>
</tr>
<tr>
<td>sign</td>
<td>签名，签名校验方式见签名算法</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>userId</td>
<td>用户id</td>
<td>String</td>
<td>是</td>
</tr>
</tbody>
</table>
<h5>Body请求参数</h5>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>appid</td>
<td>第三方应用id</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>clientId</td>
<td>子应用唯一标识，在开放平台提交子应用审核通过后获得</td>
<td>String</td>
<td>如果不存在子应用，则不需要</td>
</tr>
<tr>
<td>userId</td>
<td>用户id</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>redirect_uri</td>
<td>请使用urlEncode对链接进行处理</td>
<td>String</td>
<td>否</td>
</tr>
<tr>
<td>state</td>
<td>用于保持请求和回调的状态，授权请求后原样带回给第三方。该参数可用于防止csrf攻击（跨站请求伪造攻击），建议第三方带上该参数，可设置为简单的随机数session进行校验</td>
<td>String</td>
<td>否</td>
</tr>
</tbody>
</table>
<h4>请求示例</h4>
<pre><code>curl -XPOST -H &quot;Content-Type:application/json&quot; 'xxx.xxx.com/api/v1/oauth2/code?appid=APP_ID&amp;sign=SIGN&amp;timestamp=TIME_STAMP&amp;userId=USER_ID' -d '
 { 
  &quot;userId&quot;: &quot;USER_ID&quot;,
  &quot;appId&quot;:&quot;APP_ID&quot;,
  &quot;clientId&quot;:&quot;CLIENT_ID&quot;
}'
</code></pre>
<h4>返回说明</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码，成功code是200，失败是除成功200以外的值</td>
<td>int</td>
<td>是</td>
</tr>
<tr>
<td>msg</td>
<td>提示信息，成功是ok，失败是具体的错误提示</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>result</td>
<td>返回数据，正确的情况下包括clientId和clientSecret字段</td>
<td>Object</td>
<td>是</td>
</tr>
<tr>
<td>openId</td>
<td>oauth分配的openId</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>code</td>
<td>oauth分配的授权码</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>expireInMs</td>
<td>code的过期时间,ms</td>
<td>long</td>
<td>是</td>
</tr>
</tbody>
</table>
<h4>返回示例</h4>
<pre><code>{
  &quot;code&quot;: 10000,
  &quot;msg&quot;: &quot;ok&quot;,
  &quot;result&quot;: {
    &quot;openId&quot;: &quot;65806&quot;,
    &quot;code&quot;: &quot;PfmXFUu1Ug&quot;,
    &quot;expireInMs&quot;: 59312
  }
}
</code></pre>
<h3>4、Code换取Token</h3>
<p><code>/api/v1/oauth2/access_token</code></p>
<ul>
<li>提供方:AppServer</li>
<li>调用方:GameCenterServer</li>
<li>请求方式:<code>GET</code></li>
<li>返回数据格式:<code>json</code></li>
</ul>
<h4>参数说明</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>appid</td>
<td>应用id</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>timestamp</td>
<td>时间戳</td>
<td>Long</td>
<td>是</td>
</tr>
<tr>
<td>sign</td>
<td>签名，签名校验方式见签名算法</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>code</td>
<td>授权流程中获得的临时授权码</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>clientId</td>
<td>子应用唯一标识，在开放平台提交子应用审核通过后获得</td>
<td>String</td>
<td>如果不存在子应用，则不需要</td>
</tr>
</tbody>
</table>
<h4>请求示例</h4>
<pre><code>https://xxxxxxx/api/v1/oauth2/access_token?appid=APPID&amp;timestamp=TIMESTAMP&amp;sign=SIGN&amp;code=CODE&amp;clientId=CLIENT_ID
</code></pre>
<h4>返回数据</h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码，成功code是200，失败是除成功200以外的值</td>
<td>int</td>
<td>是</td>
</tr>
<tr>
<td>msg</td>
<td>提示信息，成功是ok，失败是具体的错误提示</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>result</td>
<td>返回数据，包含accessToken,openId,expireIn,refreshToken</td>
<td>Object</td>
<td>是</td>
</tr>
<tr>
<td>accessToken</td>
<td>授权流程返回的accessToken</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>openId</td>
<td>登陆用户的openId</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>expireInMs</td>
<td>accessToken的过期时间，单位毫秒</td>
<td>Long</td>
<td>是</td>
</tr>
<tr>
<td>refreshToken</td>
<td>accessToken过期后重新获取accessToken用(可以不实现刷新，具体看app方决定）</td>
<td>String</td>
<td>否</td>
</tr>
</tbody>
</table>
<p>示例</p>
<pre><code class="language-json">{
    "code":"200",
    "msg":"ok",
    "result":{
        "accessToken":"er8i9ryu283ifikfrjifiu",
        "openId":"deofi3ihjukfeiewfeofkj==",
        "expireInMs":6000000, // 单位秒
        "refreshToken":"de92378483ufh438yruhjf"
    }
}
</code></pre>
<p>注意：用于区分用户的 <code>openId</code> 并不是 <code>userId</code> ，请不要针对此使用。相见混淆 <code>userId</code> 章节。</p>
<h3>5、通过Token获取用户信息</h3>
<p><code>/api/v1/oauth2/user/info</code></p>
<ul>
<li>提供方:AppServer</li>
<li>调用方:GameCenterServer</li>
<li>请求方式:<code>GET</code></li>
<li>请求参数格式:<code>url parameter</code></li>
<li>返回数据格式:<code>json</code></li>
</ul>
<h5>参数说明</h5>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>appid</td>
<td>应用id</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>timestamp</td>
<td>时间戳</td>
<td>Long</td>
<td>是</td>
</tr>
<tr>
<td>sign</td>
<td>签名，签名校验方式见签名算法</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>accessToken</td>
<td>code换取到的accessToken</td>
<td>String</td>
<td>是</td>
</tr>
</tbody>
</table>
<h4>请求示例</h4>
<pre><code>https://xxxxxxx/api/v1/oauth2/user/info?appid=APPID&amp;timestamp=TIMESTAMP&amp;sign=SIGN&amp;accessToken=TOKEN
</code></pre>
<h4>数据说明</h4>
<p>注意：根据渠道的用户模型来定义</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>类型(字符长度)</th>
<th>是否必须</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>返回码，成功code是200，失败是除成功200以外的值</td>
<td>int</td>
<td>是</td>
</tr>
<tr>
<td>msg</td>
<td>提示信息，成功是ok，失败是具体的错误提示</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>result</td>
<td>返回数据，包含accessToken,openId,expireIn,refreshToken</td>
<td>Object</td>
<td>是</td>
</tr>
<tr>
<td>openId</td>
<td>授权流程中的openId,同一个oauthAppId下是相同的</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>nickname</td>
<td>用户昵称</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>avatarUrl</td>
<td>头像</td>
<td>String</td>
<td>是</td>
</tr>
<tr>
<td>mobile</td>
<td>手机号码，如有请提供，方便运营联系用户处理问题</td>
<td>String</td>
<td>否</td>
</tr>
<tr>
<td>gender</td>
<td>性别,未知0，男1，女2，如有请提供，方便做精细化运营</td>
<td>Integer</td>
<td>否</td>
</tr>
<tr>
<td>age</td>
<td>年龄，如有请提供，方便做精细化运营</td>
<td>Integer</td>
<td>否</td>
</tr>
<tr>
<td>region</td>
<td>地区,包含省市，如有请提供，方便做精细化运营</td>
<td>String</td>
<td>否</td>
</tr>
</tbody>
</table>
<p>示例</p>
<pre><code>{
    &quot;code&quot;:&quot;200&quot;,
    &quot;msg&quot;:&quot;ok&quot;,
    &quot;result&quot;:{
        &quot;openId&quot;:&quot;deofi3ihjukfeiewfeofkj==&quot;,
        &quot;mobile&quot;:&quot;13812345678&quot;,
        &quot;nickname&quot;:&quot;昵称&quot;,
        &quot;avatarUrl&quot;:&quot;http://一个头像图片.png&quot;,
        &quot;gender&quot;:1,
        &quot;age&quot;:28,
        &quot;region&quot;:&quot;浙江省杭州市&quot;
    }
}
</code></pre>
<h3>客户端接入Webview</h3>
<ul>
<li>接入链接:<a href="http://open.game.163.com/dp-sdk/webview">http://open.game.163.com/dp-sdk/webview</a></li>
<li>提供方:GameCenterServer</li>
<li>调用者:App</li>
<li>注意事项:如App是登陆状态，任何进入游戏中心的入口，包括此入口和以后可能跳转的其他入口，都需要在链接上拼接<code>code</code>，如<code>http://open.game.163.com/dp-sdk/webview?code=deiudei928398</code></li>
</ul>
<h3>附录</h3>
<h4>生成和验证签名</h4>
<p>把得到的参数添加到Map中，示例：</p>
<pre><code>long timestamp = System.currentTimeMillis();
Map&lt;String, String&gt; params = new HashMap&lt;&gt;();
params.put(&quot;accessToken&quot;, accessToken);
params.put(&quot;timestamp&quot;,String.valueOf(timestamp));
params.put(&quot;appid&quot;, appId);
String sign = genSign(params, appSecret);
//使用计算得到的signature与参数中的signature进行相等比较
</code></pre>
<p>生成签名方法，示例：</p>
<pre><code>/**
 * 生成签名信息
 * 
 * @param secretKey 游戏中心在渠道的appSecret
 *            
 * @param params
 *            接口请求参数名和参数值map，不包括signature参数名
 * @return
 */
public static String genSign(Map&lt;String, String&gt; paramsMap, String keySecret) {
		TreeMap&lt;String, String&gt; params = genAllParams(paramsMap);
		StringBuilder sb = new StringBuilder();
		sb.append(keySecret);
		for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) {
			sb.append(entry.getValue());
		}
		return DigestUtils.sha1Hex(sb.toString());
	}

	private static TreeMap&lt;String, String&gt; genAllParams(Map&lt;String, String&gt; paramsMap) {
		TreeMap&lt;String, String&gt; params = new TreeMap&lt;&gt;();
		for (String key : paramsMap.keySet()) {
			String value = paramsMap.get(key);
			params.put(key, value);
		}
		return params;
	}
</code></pre>
</section></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/blogDetail.js"></script>
</body>
</html>