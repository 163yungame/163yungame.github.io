<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="gamesdk" />
	<meta name="description" content="gamesdk" />
	<!-- 网页标签标题 -->
	<title>gamesdk</title>
  <link rel="shortcut icon" href="http://cloudgame-res.127.net/game/resource/images/cloudGame/favicon.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="http://cloudgame-res.127.net/homepage/55681a7dd72dda6286a8a17f78759fc4.png"/></a><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/resources/resources.html" target="_self">接入指引</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/client/gamesdk.html" target="_self">客户端</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/server/cloudgame-server-doc.html" target="_self">服务器</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/util/index.html" target="_self">工具</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>接入文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>接入文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/resources/resources.html" target="_self">接入指引</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>客户端<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/client/gamesdk.html" target="_self">接入指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/client/faq.html" target="_self">Q&amp;A</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务器<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/cloudgame-server-doc.html" target="_self">接入指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/php_sign_demo.html" target="_self">php下单签名示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/python_sign_demo.html" target="_self">python下单签名示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/faq.html" target="_self">Q&amp;A</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/auth/index.html" target="_self">实名认证接入文档</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>易信游戏SDK接入文档</h1>
<h2>资源引入</h2>
<ol>
<li>将<code>gamesdk-x.x.x.jar</code>引入项目</li>
<li>若游戏打包方式无法将<code>gamesdk-x.x.x.jar</code>中的<code>assets/ncggame</code>文件夹下内容打包到apk，请手动将<code>ncggame</code>复制到项目的<code>assets</code>文件夹下</li>
</ol>
<h2>参数配置</h2>
<h3>versionName</h3>
<p><code>versionName</code> 需要保证为三段式 <code>x.x.x</code> (例如：1.2.3)</p>
<h3>AndroidManifest</h3>
<ol>
<li>配置 GameID, GameSecret 在application标签下，例如</li>
</ol>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span>
    <span class="hljs-attr">android:label</span>=<span class="hljs-string">"@string/app_name"</span>
    <span class="hljs-attr">android:icon</span>=<span class="hljs-string">"@mipmap/ic_launcher"</span>
    <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/AppTheme"</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".DemoApp"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">"YX_GAME_ID"</span>
        <span class="hljs-attr">android:value</span>=<span class="hljs-string">"${YX_GAME_ID}"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">"YX_GAME_SECRET"</span>
        <span class="hljs-attr">android:value</span>=<span class="hljs-string">"${YX_GAME_SECRET}"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
</code></pre>
<ol start="2">
<li>权限配置</li>
</ol>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_PHONE_STATE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CHANGE_NETWORK_STATE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_PHONE_STATE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.GET_TASKS"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CALL_PHONE"</span>/&gt;</span>
</code></pre>
<ol start="3">
<li>其他配置</li>
</ol>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"im.yixin.gamesdk.activity.YXComponentActivity"</span>
    <span class="hljs-attr">android:configChanges</span>=<span class="hljs-string">"keyboardHidden|orientation|screenSize"</span>
    <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@android:style/Theme.Translucent.NoTitleBar"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"xx.xx.xx.xx.yxapi.YXEntryActivity"</span>
    <span class="hljs-attr">android:configChanges</span>=<span class="hljs-string">"keyboardHidden|orientation|screenSize"</span>
    <span class="hljs-attr">android:excludeFromRecents</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:launchMode</span>=<span class="hljs-string">"singleTask"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">receiver</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"xx.xx.xx.xx..yxapi.AppRegister"</span>
    <span class="hljs-attr">android:permission</span>=<span class="hljs-string">"im.yixin.sdk.permission.YIXIN_SDK_MESSAGE"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"im.yixin.sdk.api.Intent.ACTION_REFRESH_YXAPP"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span>

</code></pre>
<p><code>YXEntryActivity</code> 和 <code>AppRegister</code> 中的xx.xx.xx.xx.替换为游戏中的<code>真实路径</code></p>
<h2>YXEntryActivity，AppRegister</h2>
<p>这两个文件，请直接复制Demo中的代码</p>
<h2>初始化SDK</h2>
<p>在<code>Application</code>中初始化<br>
重要：<code>如果项目中使用了多进程，请只在主进程中初始化，否则可能会导致意想不到的问题</code></p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xxxApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Application</span> </span>{

    <span class="hljs-keyword">private</span> YXGameApi mYXGameApi;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">attachBaseContext</span><span class="hljs-params">(Context base)</span> </span>{
        <span class="hljs-keyword">super</span>.attachBaseContext(base);
        sApp = <span class="hljs-keyword">this</span>;
        mYXGameApi = YXGameApiFactory.create(base);
        mYXGameApi.onApplicationAttachBaseContext(<span class="hljs-keyword">this</span>, base);
    }
   
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onCreate();
        mYXGameApi.onApplicationCreate(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> YXGameCallbackListener&lt;Void&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">callback</span><span class="hljs-params">(<span class="hljs-keyword">int</span> status, Void aVoid)</span> </span>{
                <span class="hljs-keyword">if</span> (status == YXGameStatusCode.INIT_SUCCESS) {
                    <span class="hljs-comment">//SDK初始化成功</span>
                    YXLog.d(DemoApp.class, <span class="hljs-string">"api init success"</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status == YXGameStatusCode.INIT_ERROR) {
                    <span class="hljs-comment">//SDK初始化失败</span>
                    YXLog.d(DemoApp.class, <span class="hljs-string">"api init error"</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status == YXGameStatusCode.LOGIN_SUCCESS) {
                    <span class="hljs-comment">//调用login后，用户登陆成功</span>
                    YXLog.d(DemoApp.class, <span class="hljs-string">"login success"</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status == YXGameStatusCode.ACCOUNT_CHANGE) {
                    <span class="hljs-comment">//切换用户</span>
                    YXLog.d(DemoApp.class, <span class="hljs-string">"account change"</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status == YXGameStatusCode.LOGOUT) {
                    <span class="hljs-comment">//悬浮窗内退出账户</span>
                    YXLog.d(DemoApp.class, <span class="hljs-string">"logout"</span>);
                }
            }
        });
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onConfigurationChanged</span><span class="hljs-params">(@NonNull Configuration newConfig)</span> </span>{
        <span class="hljs-keyword">super</span>.onConfigurationChanged(newConfig);
        mYXGameApi.onApplicationConfigurationChanged(<span class="hljs-keyword">this</span>, newConfig);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onTerminate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">super</span>.onTerminate();
        mYXGameApi.onApplicationTerminate(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> YXGameApi <span class="hljs-title">yxGameApi</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> mYXGameApi;
    }
}
</code></pre>
<p>init接口回调参数说明</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>INIT_SUCCESS</td>
<td>SDK初始化成功</td>
</tr>
<tr>
<td>INIT_ERROR</td>
<td>SDK初始化失败</td>
</tr>
<tr>
<td>LOGOUT</td>
<td>悬浮窗内退出账户</td>
</tr>
<tr>
<td>LOGIN_SUCCESS</td>
<td>用户登陆成功</td>
</tr>
<tr>
<td>ACCOUNT_CHANGE</td>
<td>该次登陆的用户与之前缓存的用户信息不是同一个用户</td>
</tr>
</tbody>
</table>
<h4>注册全局监听器（可选）</h4>
<p>可在需要的地方注册全局状态监听器，来监听账户改变，回调参数通init接口中的一致</p>
<pre><code class="language-java">yxGameApi().registerGameMonitor(<span class="hljs-keyword">new</span> YXGameCallbackListener&lt;Void&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">callback</span><span class="hljs-params">(<span class="hljs-keyword">int</span> status, Void aVoid)</span> </span>{
                <span class="hljs-keyword">if</span> (status == YXGameStatusCode.LOGIN_SUCCESS) {
                    <span class="hljs-comment">//调用login后，用户登陆成功</span>
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status == YXGameStatusCode.ACCOUNT_CHANGE) {
                    <span class="hljs-comment">//切换用户</span>
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status == YXGameStatusCode.LOGOUT) {
                    <span class="hljs-comment">//悬浮窗内退出账户</span>
                }
            }
        });
</code></pre>
<h2>接口调用</h2>
<h3>登录</h3>
<p>在需要登录时调用login接口</p>
<pre><code class="language-java">yxGameApi().login(activity)
</code></pre>
<p>登录结果会回调到初始化和全局监听器注册的回调（部分情况收不到登录回调）</p>
<h3>查询登录状态</h3>
<p>因为部分情况收不到登录回调，所以请在开始游戏前调用这个接口查询登录状态，只有返回<code>true</code>才表示登录成功，此时可以进入游戏</p>
<pre><code class="language-java">yxGameApi().isLogin()
</code></pre>
<h3>获取token</h3>
<pre><code class="language-java">String token = yxGameApi().getToken()
</code></pre>
<p>在<code>登录成功</code>后可调用，获取到的token一定是有效的token，可以直接给服务器使用，服务器校验token有效性，请参考服务器文档</p>
<h3>获取用户信息</h3>
<pre><code class="language-java"><span class="hljs-keyword">try</span> {
    yxGameApi().getAccountInfo(<span class="hljs-keyword">new</span> YXGameCallbackListener&lt;GameAccount&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">callback</span><span class="hljs-params">(<span class="hljs-keyword">int</span> status, GameAccount account)</span> </span>{
            <span class="hljs-keyword">if</span> (status != YXGameStatusCode.SUCCESS || account == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span>;
            }
            System.out.println(account.getAccountId());
        }
    });
} <span class="hljs-keyword">catch</span> (Exception e) {
    e.printStackTrace();
}
</code></pre>
<h3>登出</h3>
<pre><code class="language-java">yxGameApi().logout();
</code></pre>
<p>登出结果会回调到初始化和全局监听器注册的回调</p>
<h3>退出游戏</h3>
<pre><code class="language-java">yxGameApi().exit(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> YXGameCallbackListener&lt;Boolean&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">callback</span><span class="hljs-params">(<span class="hljs-keyword">int</span> status, Boolean exit)</span> </span>{
                <span class="hljs-keyword">if</span> (exit) {
                    <span class="hljs-comment">//退出游戏</span>
                    finish();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">//不退出</span>
                }
            }
        });
</code></pre>
<h3>支付</h3>
<pre><code class="language-java">YXTrade trade = <span class="hljs-keyword">new</span> YXTrade();
trade.setId(tradeId);
trade.setGateUrl(payGateUrl);
trade.setResult(YXTrade.RESULT_OK);
<span class="hljs-keyword">new</span> YXPayApi(PayActivity.<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> YXPayDelegate() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onTradeComplete</span><span class="hljs-params">(<span class="hljs-keyword">int</span> resultCode)</span> </span>{
                    <span class="hljs-comment">// 注意回调在UI主线程中，对http请求需要异步调用</span>
                    <span class="hljs-keyword">if</span> (resultCode == YXPayResultCode.SUCCESS) {
                        <span class="hljs-comment">//支付成功</span>
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (resultCode == YXPayResultCode.USER_CANCEL) {
                        <span class="hljs-comment">//用户取消支付</span>
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">//支付异常</span>
                    }
                }
            }).pay(trade);
</code></pre>
<p><code>tradeId</code>和<code>payGateUrl</code>从游戏自己服务器下单后获取，具体请参考服务器支付文档</p>
<h2>混淆</h2>
<p>如果开启混淆，请添加下面的代码：</p>
<pre><code class="language-java">-keep <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">com</span>.<span class="hljs-title">squareup</span>.** </span>{*;}
-dontwarn com.squareup.**
-keep <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">im</span>.<span class="hljs-title">yixin</span>.** </span>{*;}
-dontwarn im.yixin.**
</code></pre>
</div></section></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>