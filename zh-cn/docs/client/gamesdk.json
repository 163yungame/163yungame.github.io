{
  "filename": "gamesdk.md",
  "__html": "<h1>网易云游戏SDK接入文档</h1>\n<h3>快速使用</h3>\n<h4>资源引入</h4>\n<ol>\n<li>将gamesdk-x.x.x.jar引入项目</li>\n<li><code>若游戏打包方式无法将gamesdk-x.x.x.jar中的assets文件夹下内容打包到apk，请手动将assets复制到项目的assets文件夹下</code></li>\n</ol>\n<h4>参数配置</h4>\n<h5>AndroidManifest配置</h5>\n<ol>\n<li><code>versionName</code> 需要保证为三段式 <code>x.x.x</code> (例1.2.3)</li>\n<li>GameID, GameSecret 配置再application标签下，例如</li>\n</ol>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">application</span>\n    <span class=\"hljs-attr\">android:label</span>=<span class=\"hljs-string\">\"@string/app_name\"</span>\n    <span class=\"hljs-attr\">android:icon</span>=<span class=\"hljs-string\">\"@mipmap/ic_launcher\"</span>\n    <span class=\"hljs-attr\">android:theme</span>=<span class=\"hljs-string\">\"@style/AppTheme\"</span>\n    <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\".DemoApp\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta-data</span>\n        <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"YX_GAME_ID\"</span>\n        <span class=\"hljs-attr\">android:value</span>=<span class=\"hljs-string\">\"${YX_GAME_ID}\"</span>/&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta-data</span>\n        <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"YX_GAME_SECRET\"</span>\n        <span class=\"hljs-attr\">android:value</span>=<span class=\"hljs-string\">\"${YX_GAME_SECRET}\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">application</span>&gt;</span>\n</code></pre>\n<ol start=\"2\">\n<li>权限配置</li>\n</ol>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.INTERNET\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.WRITE_EXTERNAL_STORAGE\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.READ_PHONE_STATE\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.ACCESS_WIFI_STATE\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.ACCESS_NETWORK_STATE\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.CHANGE_NETWORK_STATE\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.READ_PHONE_STATE\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.ACCESS_WIFI_STATE\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.ACCESS_FINE_LOCATION\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.GET_TASKS\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">uses-permission</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.permission.CALL_PHONE\"</span>/&gt;</span>\n</code></pre>\n<ol start=\"3\">\n<li>其他配置</li>\n</ol>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">activity</span>\n    <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"im.yixin.gamesdk.activity.YXComponentActivity\"</span>\n    <span class=\"hljs-attr\">android:configChanges</span>=<span class=\"hljs-string\">\"keyboardHidden|orientation|screenSize\"</span>\n    <span class=\"hljs-attr\">android:theme</span>=<span class=\"hljs-string\">\"@android:style/Theme.Translucent.NoTitleBar\"</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">activity</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">activity</span>\n    <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"xx.xx.xx.xx.yxapi.YXEntryActivity\"</span>\n    <span class=\"hljs-attr\">android:configChanges</span>=<span class=\"hljs-string\">\"keyboardHidden|orientation|screenSize\"</span>\n    <span class=\"hljs-attr\">android:excludeFromRecents</span>=<span class=\"hljs-string\">\"true\"</span>\n    <span class=\"hljs-attr\">android:exported</span>=<span class=\"hljs-string\">\"true\"</span>\n    <span class=\"hljs-attr\">android:launchMode</span>=<span class=\"hljs-string\">\"singleTask\"</span>/&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">receiver</span>\n    <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"xx.xx.xx.xx..yxapi.AppRegister\"</span>\n    <span class=\"hljs-attr\">android:permission</span>=<span class=\"hljs-string\">\"im.yixin.sdk.permission.YIXIN_SDK_MESSAGE\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">intent-filter</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"im.yixin.sdk.api.Intent.ACTION_REFRESH_YXAPP\"</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">intent-filter</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">receiver</span>&gt;</span>\n\n</code></pre>\n<p><code>YXEntryActivity</code> 和 <code>AppRegister</code> 中的xx.xx.xx.xx.替换为游戏中的<code>真实路径</code></p>\n<h4>初始化SDK</h4>\n<p>在<code>Application</code>中初始化</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">xxxApp</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Application</span> </span>{\n\n    <span class=\"hljs-keyword\">private</span> YXGameApi gameApi;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onCreate</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">super</span>.onCreate();\n        gameApi = YXGameApiFactory.init(<span class=\"hljs-keyword\">this</span>, <span class=\"hljs-keyword\">new</span> YXGameCallbackListener&lt;Void&gt;() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">callback</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> status, Void aVoid)</span> </span>{\n                <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.INIT_SUCCESS) {\n                    <span class=\"hljs-comment\">//SDK初始化成功</span>\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.INIT_ERROR) {\n                    <span class=\"hljs-comment\">//SDK初始化失败</span>\n\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.LOGIN_SUCCESS) {\n                    <span class=\"hljs-comment\">//调用login后，用户登陆成功</span>\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.ACCOUNT_CHANGE) {\n                    <span class=\"hljs-comment\">//切换用户</span>\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.LOGOUT) {\n                    <span class=\"hljs-comment\">//悬浮窗内退出账户</span>\n                }\n            }\n        });\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> YXGameApi <span class=\"hljs-title\">yxGameApi</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">return</span> gameApi;\n    }\n}\n</code></pre>\n<p>init接口回调参数说明</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>INIT_SUCCESS</td>\n<td>SDK初始化成功</td>\n</tr>\n<tr>\n<td>INIT_ERROR</td>\n<td>SDK初始化失败</td>\n</tr>\n<tr>\n<td>LOGOUT</td>\n<td>悬浮窗内退出账户</td>\n</tr>\n<tr>\n<td>LOGIN_SUCCESS</td>\n<td>用户登陆成功</td>\n</tr>\n<tr>\n<td>ACCOUNT_CHANGE</td>\n<td>该次登陆的用户与之前缓存的用户信息不是同一个用户</td>\n</tr>\n</tbody>\n</table>\n<h4>注册全局监听器（可选）</h4>\n<p>可在需要的地方注册全局状态监听器，来监听账户改变，回调参数通init接口中的一致</p>\n<pre><code class=\"language-java\">yxGameApi().registerGameMonitor(<span class=\"hljs-keyword\">new</span> YXGameCallbackListener&lt;Void&gt;() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">callback</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> status, Void aVoid)</span> </span>{\n                <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.LOGIN_SUCCESS) {\n                    <span class=\"hljs-comment\">//调用login后，用户登陆成功</span>\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.ACCOUNT_CHANGE) {\n                    <span class=\"hljs-comment\">//切换用户</span>\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (status == YXGameStatusCode.LOGOUT) {\n                    <span class=\"hljs-comment\">//悬浮窗内退出账户</span>\n                }\n            }\n        });\n</code></pre>\n<h4>登录</h4>\n<p>在需要登录的时刻调用login接口</p>\n<pre><code class=\"language-java\">yxGameApi().login(activity)\n</code></pre>\n<p>登录结果会回调到初始化和全局监听器注册的回调</p>\n<h4>YXEntryActivity，AppRegister</h4>\n<p>该两个文件，请直接复制Demo中的代码</p>\n<h4>接口调用</h4>\n<ol>\n<li>获取token</li>\n</ol>\n<pre><code class=\"language-java\">String token = yxGameApi().getToken()\n</code></pre>\n<p>在<code>登录成功</code>后可调用，获取到的token一定是有效的token，可以直接给服务器使用，服务器校验token有效性，请参考服务器文档</p>\n<ol start=\"2\">\n<li>获取用户信息</li>\n</ol>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">try</span> {\n    yxGameApi().getAccountInfo(<span class=\"hljs-keyword\">new</span> YXGameCallbackListener&lt;GameAccount&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">callback</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> status, GameAccount account)</span> </span>{\n            <span class=\"hljs-keyword\">if</span> (status != YXGameStatusCode.SUCCESS || account == <span class=\"hljs-keyword\">null</span>) {\n                <span class=\"hljs-keyword\">return</span>;\n            }\n            System.out.println(account.getAccountId());\n        }\n    });\n} <span class=\"hljs-keyword\">catch</span> (Exception e) {\n    e.printStackTrace();\n}\n</code></pre>\n<ol start=\"3\">\n<li>通知SDK登出账户</li>\n</ol>\n<pre><code class=\"language-java\">yxGameApi().logout();\n</code></pre>\n<p>登出结果会回调到初始化和全局监听器注册的回调</p>\n<ol start=\"4\">\n<li>退出游戏</li>\n</ol>\n<pre><code class=\"language-java\">yxGameApi().exit(<span class=\"hljs-keyword\">this</span>, <span class=\"hljs-keyword\">new</span> YXGameCallbackListener&lt;Boolean&gt;() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">callback</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> status, Boolean exit)</span> </span>{\n                <span class=\"hljs-keyword\">if</span> (exit) {\n                    <span class=\"hljs-comment\">//退出游戏</span>\n                    finish();\n                } <span class=\"hljs-keyword\">else</span> {\n                    <span class=\"hljs-comment\">//不退出</span>\n                }\n            }\n        });\n</code></pre>\n<h4>支付</h4>\n<pre><code class=\"language-java\">YXTrade trade = <span class=\"hljs-keyword\">new</span> YXTrade();\ntrade.setId(tradeId);\ntrade.setGateUrl(payGateUrl);\ntrade.setResult(YXTrade.RESULT_OK);\n<span class=\"hljs-keyword\">new</span> YXPayApi(PayActivity.<span class=\"hljs-keyword\">this</span>, <span class=\"hljs-keyword\">new</span> YXPayDelegate() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onTradeComplete</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> resultCode)</span> </span>{\n                    <span class=\"hljs-comment\">// 注意回调在UI主线程中，对http请求需要异步调用</span>\n                    <span class=\"hljs-keyword\">if</span> (resultCode == YXPayResultCode.SUCCESS) {\n                        <span class=\"hljs-comment\">//支付成功</span>\n                    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (resultCode == YXPayResultCode.USER_CANCEL) {\n                        <span class=\"hljs-comment\">//用户取消支付</span>\n                    } <span class=\"hljs-keyword\">else</span> {\n                        <span class=\"hljs-comment\">//支付异常</span>\n                    }\n                }\n            }).pay(trade);\n</code></pre>\n<p><code>tradeId</code>和<code>payGateUrl</code>从游戏自己服务器下单后获取，具体请参考服务器支付文档</p>\n<h4>混淆</h4>\n<pre><code class=\"language-java\">proguard 不要混淆sdk，相关代码 如下\n-keep <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">com</span>.<span class=\"hljs-title\">squareup</span>.** </span>{*;}\n-dontwarn com.squareup.**\n-keep <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">im</span>.<span class=\"hljs-title\">yixin</span>.** </span>{*;}\n-dontwarn im.yixin.**\n\n</code></pre>\n"
}