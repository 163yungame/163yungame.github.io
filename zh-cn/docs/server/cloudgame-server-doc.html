<!--
 * @Author: huangyang@yixin.im
 * @Date: 2020-03-09 14:27:12
 * @LastEditors: huangyang@yixin.im
 * @LastEditTime: 2024-07-23 11:02:25
 * @Description: 
-->
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="cloudgame-server-doc" />
	<meta name="description" content="cloudgame-server-doc" />
	<!-- 网页标签标题 -->
	<title>cloudgame-server-doc</title>
  	<link rel="shortcut icon" href="https://res.yixinyouxi.cn/yxgame/favicon.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="https://res.yixinyouxi.cn/yxgame/8a49e8068bc75bbc018ca906d3420012.png"/></a><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/resources/resources.html" target="_self">接入指引</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/client/gamesdk.html" target="_self">客户端</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/server/cloudgame-server-doc.html" target="_self">服务器</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/util/index.html" target="_self">工具</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>接入文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>接入文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/resources/resources.html" target="_self">接入指引</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>客户端<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/client/gamesdk.html" target="_self">接入指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/client/faq.html" target="_self">Q&amp;A</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务器<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/cloudgame-server-doc.html" target="_self">接入指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/php_sign_demo.html" target="_self">php下单签名示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/python_sign_demo.html" target="_self">python下单签名示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/faq.html" target="_self">Q&amp;A</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/auth/index.html" target="_self">实名认证接入文档</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>行者之地服务端接入文档</h1>
<h2>0.版本变更记录</h2>
<table>
<thead>
<tr>
<th>修订内容描述</th>
<th>修订日期</th>
<th>版本号</th>
</tr>
</thead>
<tbody>
<tr>
<td>创建文档</td>
<td>20140130</td>
<td>1.0</td>
</tr>
<tr>
<td>去掉goodscount参数</td>
<td>20140221</td>
<td>1.1</td>
</tr>
<tr>
<td>重构文档</td>
<td>20140226</td>
<td>1.2</td>
</tr>
<tr>
<td>增加手机话费支付更新商品信息说明。</td>
<td>20140311</td>
<td>1.3</td>
</tr>
<tr>
<td>增加Android客户端集成支付SDK</td>
<td>20140312</td>
<td>1.4</td>
</tr>
<tr>
<td>修改Android客户端集成支付SDK说明</td>
<td>20150527</td>
<td>1.5</td>
</tr>
<tr>
<td>增加文字描述</td>
<td>20150909</td>
<td>1.6</td>
</tr>
<tr>
<td>更新银联SDK</td>
<td>20150916</td>
<td>1.7</td>
</tr>
<tr>
<td>新增网易支付SDK</td>
<td>20160504</td>
<td>1.8</td>
</tr>
<tr>
<td>新增微信支付SDK</td>
<td>20160605</td>
<td>1.9</td>
</tr>
<tr>
<td>更新网易支付SDK</td>
<td>20160711</td>
<td>2.0</td>
</tr>
<tr>
<td>添加透传机制</td>
<td>20161226</td>
<td>2.1</td>
</tr>
<tr>
<td>增加获取用户信息接口</td>
<td>20170915</td>
<td>2.2</td>
</tr>
<tr>
<td>增加支付流程角色说明</td>
<td>20170917</td>
<td>2.3</td>
</tr>
<tr>
<td>梳理异常和签名错误FAQ</td>
<td>20171010</td>
<td>2.4</td>
</tr>
<tr>
<td>文档markdown，删除无用信息</td>
<td>20180813</td>
<td>2.5</td>
</tr>
<tr>
<td>支付流程变更</td>
<td>20210104</td>
<td>3.0</td>
</tr>
<tr>
<td>实名认证接口变更</td>
<td>20210510</td>
<td>3.2</td>
</tr>
</tbody>
</table>
<h2>1.支付流程</h2>
<p><font color=red>重大提醒：</font></p>
<ul>
<li>
<p>客户端5.3.0之前版本下单流程由游戏服务端发起，客户端5.3.0版本及以上由客户端直接发起下单，服务器不再需要请求原下单接口，请各游戏渠道做到版本兼容。</p>
</li>
<li>
<p>客户端5.3.2版本及以上实名认证请求新接口：<a href="http://yixingame.cn/sdk/user/center/info%EF%BC%8C">http://yixingame.cn/sdk/user/center/info，</a> 请各游戏渠道做到版本兼容。</p>
</li>
</ul>
<h3>1.1 支付中各角色交互说明</h3>
<p><img src="https://res.yixinyouxi.cn/yxgame/067e22fdee9d2839b24efd1b99bfbd87.jpg" alt="支付中各角色交互说明"></p>
<p><strong>参与支付流程交互的角色有：</strong></p>
<ul>
<li><strong>游戏APP（以下也称第三方App）</strong>：需要集成游戏SDK
<ul>
<li>调用游戏Server接口生成订单</li>
<li>调用SDK接口进行支付</li>
</ul>
</li>
<li><strong>游戏Server（以下也称第三方服务器）</strong>：
<ul>
<li>负责生成订单，并将订单信息持久化到第三方服务器</li>
<li>负责接收我方Server支付回调，处理发货逻辑</li>
</ul>
</li>
<li><strong>我方Server（以下也称PayServer）</strong>
<ul>
<li>根据游戏Server订单，生成订单信息（Trade信息），返回给游戏App</li>
<li>接收支付工具Server（如支付宝、微信等）的回调，并回调游戏Server接口</li>
</ul>
</li>
</ul>
<p>从上面的描述中，第三方游戏仅需要关心以下部分流程:</p>
<ol>
<li>游戏App向游戏Server发起生成订单</li>
<li>游戏App调用游戏SDK接口发起支付</li>
<li>游戏Server接收我方Server异步支付成功回调</li>
</ol>
<h3>1.2 完整交易流程</h3>
<p><img src="https://res.yixinyouxi.cn/yxgame/9f90aedb103cdde8459dcd908662b138.jpg" alt=""></p>
<p><strong>流程说明</strong></p>
<p>由流程图可知</p>
<ol>
<li><code>第三方APP</code>负责调用<code>第三方Server``生成订单1.1</code>，并处理返回值、调用支付接口。用户支付完成后，<code>SDK</code>回调<code>接口返回支付结果2.7</code>给<code>第三方APP</code></li>
<li><code>第三方Server</code>负责生成订单，并将订单信息持久化到数据库。</li>
<li><code>第三方Server</code>负责处理支付通知，并对支付成功的订单进行发货、更改数据库状态，在支付成功后，<code>PayServer</code>通过<code>异步发送支付通知4.1</code>通知<code>第三方Server</code>发货，<code>第三方Server</code>自行进行发货。</li>
</ol>
<p><strong><code>流程注意点</code></strong></p>
<ol>
<li>调用支付接口时都<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>必须</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">传递用户的access_token，用于提取用户名、验证。</li>
<li><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>任一步</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">都可能中断，要保证最终数据的一致性、正确。比如悬挂订单最终要超时。</li>
<li><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>任一步</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">都要签名，防篡改、欺骗、重放。</li>
<li><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>任一步</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">都有可能多次重复调用，被调用者负责去重。</li>
</ol>
<h2>2.服务端接口</h2>
<p>服务器端接口包括<code>第三方Server</code>、<code>PayServer</code>提供给对方和Android客户端的接口。主要包括订单生成、支付通知两类接口。考虑到安全性，除了用户输入、UI交互接口需要在Android端完成，其他跟支付有关的接口必须在服务器端进行调用。签名由服务器端进行，公钥不要暴露在Android端。</p>
<h3>2.1 接口约定</h3>
<h4>2.1.1 订单信息持久化</h4>
<p><code>第三方Server</code>需要对订单信息包括订单id、支付状态、各类时间戳等信息、接口参数使用数据库进行持久化用来对账。</p>
<h4>2.1.2 支付通知并发</h4>
<p>支付完成后<code>Payserver</code>调用<code>第三方Server</code>接口通知发货，相同订单支付通知接口可能被调用多次，需要去重并避免重复发货等问题。如更新数据库时可以使用类似的SQL:</p>
<pre><code class="language-sql"><span class="hljs-keyword">update</span> Trade <span class="hljs-keyword">set</span> PayState=Payed <span class="hljs-keyword">where</span> PayState=UnPay <span class="hljs-keyword">and</span> <span class="hljs-keyword">Id</span>=?;
</code></pre>
<h4>2.1.3 两个公钥，一个私钥<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>很重要</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""></h4>
<p>我方需要两个公钥一个私钥。请<code>谨记</code>括号里面的名字。</p>
<ol>
<li>游戏方接入方公钥及私钥请联系贵方商务或运营从开发者后台获取。(以下称<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>游戏方公钥</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">或<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>游戏方私钥</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">)
<img src="http://res.yixinyouxi.cn/yxgame/0be8e326369a4f64a44b03c193faf243.jpg" alt="游戏方接入方公私钥获取"></li>
<li>平台公钥(以下称<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>平台公钥</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">)</li>
</ol>
<pre><code>30819f300d06092a864886f70d010101050003818d0030818902818100ac1b8d63bcaf49cdd0d1e79c916aba0250421b3ee8eaf134f80843c5033e30a150b9e26e78025fde8e52538d4beb572940966b0c80460d90a26c9119a0d28c4277024dbeb20e31403360aeca70da506a19d89e95512e5347be0eae9b2c49da3150a93e3bc80817fa9a1d8170555e6117c86f84f13afc39944fb6bdfc85e3723b0203010001
</code></pre>
<h4><h4 id='sign'>2.1.4 签名校验及参数值编码</h4></h4>
<p><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>非常重要</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">绝大部分平台接入失败都卡在签名这一步，请仔细阅读下面各点。</p>
<h5>2.1.4.1 注意点</h5>
<ol>
<li>拼接在请求URL上的参数，需要进行URLEncode, 如<code>String param = URLEncoder.encode(&quot;2014-01-01 12:12:12&quot;, &quot;UTF-8&quot;);</code>, 输出为<code>2014-01-01+12%3A12%3A12</code></li>
<li><code>第三方Server</code>接收<code>PayServer</code>的支付通知回调接口的<code>sign签名</code>字段操作
<ul>
<li>将参与签名的参数进行<code>字符串拼接</code> (参与签名计算的参数会在每个接口中进行说明)</li>
<li><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>需要、需要、需要</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">进行<code>URLEncode</code></li>
<li>使用<code>Android Demo</code>工程的类<code>im.yixin.game.demo.rsa.RSA</code>中的<code>RSA.verify()</code>接口和<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>平台公钥</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">以及上述拼接字符串验证<code>sign</code>参数是否正确，正确再执行业务逻辑</li>
</ul>
</li>
</ol>
<h5>2.1.4.2 生成和验证签名Java Demo</h5>
<p><a href="https://163yungame.github.io/zh-cn/util/index.html">在线验证签名</a></p>
<ul>
<li>生成签名流程</li>
</ul>
<pre><code class="language-java"><span class="hljs-comment">// 生成签名 需要哪些参数请仔细看每个接口的说明</span>
StringBuilder signSrcSb = <span class="hljs-keyword">new</span> StringBuilder();
signSrcSb.append(v);
signSrcSb.append(thirdpart_orderid);
signSrcSb.append(thirdpart_ordertime);
signSrcSb.append(tradeName);
signSrcSb.append(access_token);
<span class="hljs-comment">// 如果goodscount为1或不传则不需要添加此项</span>
<span class="hljs-keyword">if</span> (goodscount &gt; <span class="hljs-number">1L</span>) {
    signSrcSb.append(goodscount);
}
<span class="hljs-comment">// 需不需要Encode，参考每个接口的说明，每个都不一样，请仔细看，不需要的话直接用</span>
<span class="hljs-comment">// String signSrc = signSrcSb.toString(); 即可</span>
String signSrc = URLEncoder.encode(signSrcSb.toString(), <span class="hljs-string">"UTF-8"</span>);
<span class="hljs-comment">// 注意看接口说明，一般情况生成签名用privateKey，验证签名用publicKey</span>
PrivateKey privateKey = RSA.getPrivateKey(<span class="hljs-string">"游戏方私钥"</span>);
String sign = RSA.sign(privateKey, signSrc);
</code></pre>
<ul>
<li>验证签名流程</li>
</ul>
<pre><code class="language-java"><span class="hljs-comment">// 验证签名 具体需要拼接哪些参数，请查看后续接口文档</span>
StringBuilder signSrcSb4Ret = <span class="hljs-keyword">new</span> StringBuilder();
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"v"</span>));
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"thirdpart_orderid"</span>));
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"thirdpart_ordertime"</span>));
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"result"</span>));
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"trade_serialid"</span>));
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"goodsprice"</span>));
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"goodsamount"</span>));
signSrcSb4Ret.append(retMap.get(<span class="hljs-string">"pay_url"</span>));
<span class="hljs-keyword">if</span> (goodscount &gt; <span class="hljs-number">1L</span>) {
    signSrcSb4Ret.append(goodscount);
}
<span class="hljs-comment">//</span>
PublicKey publicKey = RSA.getPublicKey(<span class="hljs-string">"平台公钥"</span>)
<span class="hljs-comment">// signSrcSb4Ret.toString() 查看接口文档决定此处是否需要URLEncode</span>
<span class="hljs-comment">// 验证失败则抛出异常</span>
RSA.verify(publicKey, sign, signSrcSb4Ret.toString());
</code></pre>
<h3>2.2 返回异常说明</h3>
<table>
<thead>
<tr>
<th>异常码</th>
<th>说明</th>
<th>用户页面提示文案</th>
</tr>
</thead>
<tbody>
<tr>
<td>-1</td>
<td>服务器内部异常。未知异常，或无需详细说明的一般性异常。</td>
<td>支付请求失败，请重试</td>
</tr>
<tr>
<td>-2</td>
<td>登陆账号异常</td>
<td>账号登录失败，请重试</td>
</tr>
<tr>
<td>-3</td>
<td>生成签名失败</td>
<td>生成签名失败，请重试</td>
</tr>
<tr>
<td>-4</td>
<td>验证签名失败</td>
<td>验证签名失败，请重试</td>
</tr>
<tr>
<td>-5</td>
<td>商品不存在</td>
<td>商品不存在，请重试</td>
</tr>
<tr>
<td>-6</td>
<td>订单不存在</td>
<td>订单不存在，请重试</td>
</tr>
<tr>
<td>-7</td>
<td>支付方式错误</td>
<td>支付方式错误，请重试</td>
</tr>
<tr>
<td>-8</td>
<td>参数非法</td>
<td>参数非法</td>
</tr>
<tr>
<td>-9</td>
<td>支付超时</td>
<td>支付超时，请重新支付</td>
</tr>
<tr>
<td>-10</td>
<td>更新支付类型失败(已经有支付类型或者已经支付)</td>
<td>更新支付类型失败</td>
</tr>
<tr>
<td>-31</td>
<td>第三方订单号重复</td>
<td>订单重复</td>
</tr>
<tr>
<td>-51</td>
<td>支付工具通知的支付状态非法</td>
<td>无效订单</td>
</tr>
<tr>
<td>-101</td>
<td>服务器内部错误，数据库异常</td>
<td>支付数据请求失败，请重试</td>
</tr>
<tr>
<td>-1001</td>
<td>渠道游戏的状态为停用，无法下单</td>
<td>无效订单</td>
</tr>
</tbody>
</table>
<h3>2.3 PayServer异步支付通知</h3>
<p>本接口为流程图中的<code>异步发送支付通知 4.1</code>接口。Android页面通知可能因为网络故障导致通知失败，需要<code>PayServer</code>多次异步通知来保证通知到<code>第三方Server</code>。</p>
<ol>
<li><code>第三方Server</code>可以将此接口和Android页面通知接口在同一个接口中合并处理，此接口增加了<code>notifyid</code>、<code>notifytime</code>两个参数，并且<code>from</code>值不一样。</li>
<li><code>第三方Server</code>需要去重，可能会重复通知，避免多次发货</li>
<li>当<code>第三方Server</code>响应<code>success</code>字符串时，<code>PayServer</code>停止异步通知，否则按如下时间间隔不断通知直到收到<code>success</code>：40秒、2分钟、5分钟、10分钟、30分钟、1小时、2小时、6小时、15小时，超过以上时间后，即使没接收到<code>success</code>也不再通知。</li>
</ol>
<h4>2.3.1 接口定义</h4>
<ul>
<li>URL: <code>第三方Server</code>定义并填写到开发者后台的对应游戏配置中</li>
<li>提供方: <code>第三方Server</code></li>
<li>调用方: <code>PayServer</code></li>
<li>请求方式: <code>POST</code></li>
</ul>
<h4>2.3.2 请求参数</h4>
<p><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>拼接在URL中</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>参数名称(FulfillWithEngCharacter)</th>
<th>参数说明</th>
<th>类型(字符长度)</th>
</tr>
</thead>
<tbody>
<tr>
<td>v</td>
<td>接口版本号</td>
<td></td>
<td>String</td>
</tr>
<tr>
<td>thirdpart_orderid</td>
<td>第三方唯一订单id</td>
<td></td>
<td>String</td>
</tr>
<tr>
<td>thirdpart_ordertime</td>
<td>第三方订单下单时间</td>
<td></td>
<td>String</td>
</tr>
<tr>
<td>tradeName</td>
<td>商品名称</td>
<td></td>
<td>String</td>
</tr>
<tr>
<td>result</td>
<td>返回结果</td>
<td>正常0、异常时返回异常号。返回异常时其他字段可能不返回。</td>
<td>int</td>
</tr>
<tr>
<td>trade_serialid</td>
<td>支付平台订单序列号</td>
<td></td>
<td>String</td>
</tr>
<tr>
<td>goodsprice</td>
<td>商品单价</td>
<td>单位元，精确到分，如0.01元</td>
<td>String</td>
</tr>
<tr>
<td>goodsamount</td>
<td>支付金额</td>
<td>单位元，精确到分，如0.01元</td>
<td>String</td>
</tr>
<tr>
<td>paystatus</td>
<td>支付结果</td>
<td>支付状态：0未支付1已支付成功2关闭。result返回0时才有此字段。</td>
<td>int</td>
</tr>
<tr>
<td>paytime</td>
<td>付款时间</td>
<td></td>
<td>long</td>
</tr>
<tr>
<td>paytooltype</td>
<td>支付工具类型</td>
<td></td>
<td>int</td>
</tr>
<tr>
<td>notifyid</td>
<td>通知内部id</td>
<td>用于校验</td>
<td>long</td>
</tr>
<tr>
<td>notifytime</td>
<td>通知时间戳</td>
<td></td>
<td>long</td>
</tr>
<tr>
<td>from</td>
<td>来源参数</td>
<td>值固定为<code>backend</code></td>
<td>String</td>
</tr>
<tr>
<td>sign</td>
<td>签名</td>
<td>请先阅读<a href="#sign">2.1.4 签名校验及参数值编码</a>,参与签名的参数<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">严格<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">依照以下顺序，中间的<code>+</code>表示前后字符串直接拼接，不要把<code>+</code>加到字符串中，拼接后<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>需要URLEncode</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">, <code>v+thirdpart_orderid+thirdpart_ordertime+tradeName+result+trade_serialid+goodsprice+goodsamount+paystatus+paytime+paytooltype+notifyid+notifytime+from</code>,使用<img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt=""><code>平台公钥</code><img src="http://res.yixinyouxi.cn/yxgame/d90c6c4f9c6d4f668739eb8f40b34e4a.png" alt="">进行签名验证计算</td>
<td>String</td>
</tr>
</tbody>
</table>
<h4>2.3.3 返回值</h4>
<p>成功处理则返回<code>success</code>这7个字符，失败返回<code>fail</code>。</p>
<h3>2.4 获取用户信息</h3>
<p>获取用户信息，校验access_token有效性, 本接口无签名校验</p>
<h4>2.4.1 接口定义</h4>
<ul>
<li>URL: <code>https://yixingame.cn/api/user/info</code></li>
<li>提供方: <code>PayServer</code></li>
<li>调用方: <code>第三方Server</code></li>
<li>请求方式: <code>GET</code></li>
</ul>
<h4>2.4.2 请求参数</h4>
<p>拼接在URL中</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>参数名称(FulfillWithEngCharacter)</th>
<th>参数说明</th>
<th>类型(字符长度)</th>
</tr>
</thead>
<tbody>
<tr>
<td>access_token</td>
<td>token值</td>
<td>从客户端获取的token值</td>
<td>String</td>
</tr>
</tbody>
</table>
<h4>2.4.3 返回值</h4>
<ul>
<li>返回值格式: <code>JSON</code></li>
<li>异常返回格式: <code>非1</code>的<code>code</code>值都是异常返回，<code>code</code>一定有，<code>errorMsg</code>可能没有</li>
</ul>
<pre><code class="language-json">{
	<span class="hljs-attr">"code"</span>: <span class="hljs-number">400</span>,
	<span class="hljs-attr">"errorMsg"</span>: <span class="hljs-string">"access_token is illegal,oauthUserApp is empty"</span>
}
</code></pre>
<ul>
<li>正常返回时，<code>code</code>值为<code>1</code></li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>参数名称(FulfillWithEngCharacter)</th>
<th>参数说明</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>code</td>
<td>响应码</td>
<td>响应码，1为正确，其他都是异常</td>
<td>int</td>
</tr>
<tr>
<td>userinfo</td>
<td>用户信息</td>
<td>code为1时有</td>
<td>Object</td>
</tr>
<tr>
<td>accountId</td>
<td>支付方用户账号</td>
<td>包含在userinfo内，支付方用户账号</td>
<td>String</td>
</tr>
<tr>
<td>nick</td>
<td>用户昵称</td>
<td>包含在userinfo内，用户昵称</td>
<td>String</td>
</tr>
<tr>
<td>icon</td>
<td>用户头像</td>
<td>包含在userinfo内，用户头像</td>
<td>String</td>
</tr>
<tr>
<td>registerUser</td>
<td>为用户是否在支付方已经实名认证</td>
<td>包含在userinfo内，是否在支付方已经实名认证</td>
<td>boolean</td>
</tr>
</tbody>
</table>
<p>示例</p>
<pre><code class="language-json">{
	<span class="hljs-attr">"userinfo"</span>: {
		<span class="hljs-attr">"accountId"</span>: <span class="hljs-string">"7a950a752ca8bef6"</span>,
		<span class="hljs-attr">"nick"</span>: <span class="hljs-string">"yazhitest"</span>,
		<span class="hljs-attr">"icon"</span>: <span class="hljs-string">"http://nos.netease.com/yixinpublic/pr_tp8qsfuk8xlsyhj98qooeq==_1422263772_13102"</span>,
		<span class="hljs-attr">"registerUser"</span>: <span class="hljs-literal">true</span>
	},
	<span class="hljs-attr">"code"</span>: <span class="hljs-number">1</span>
}
</code></pre>
</div></section></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>