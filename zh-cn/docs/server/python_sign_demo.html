<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="python_sign_demo" />
	<meta name="description" content="python_sign_demo" />
	<!-- 网页标签标题 -->
	<title>python_sign_demo</title>
  <link rel="shortcut icon" href="http://cloudgame-res.127.net/game/resource/images/cloudGame/favicon.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="http://nosdn-yx.127.net/yxgame/8a49e81367a10d270167a11734c30003.png"/></a><div class="header-menu"><img class="header-menu-toggle" src="/img/system/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="/zh-cn/index.html" target="_self">首页</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/resources/resources.html" target="_self">接入指引</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/client/gamesdk.html" target="_self">客户端</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/docs/server/cloudgame-server-doc.html" target="_self">服务器</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/util/index.html" target="_self">工具</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/system/docs.png" class="front-img"/><span>接入文档</span><img src="/img/system/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>接入文档</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/resources/resources.html" target="_self">接入指引</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>客户端<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/client/gamesdk.html" target="_self">接入指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/client/faq.html" target="_self">Q&amp;A</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务器<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/system/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/cloudgame-server-doc.html" target="_self">接入指南</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/php_sign_demo.html" target="_self">php下单签名示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/python_sign_demo.html" target="_self">python下单签名示例</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/server/faq.html" target="_self">Q&amp;A</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>python 签名示例</h1>
<pre><code class="language-python"><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA
<span class="hljs-keyword">from</span> Crypto.Signature <span class="hljs-keyword">import</span> PKCS1_v1_5
<span class="hljs-keyword">from</span> Crypto.Hash <span class="hljs-keyword">import</span> SHA
<span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> hexlify
<span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> quote_plus

<span class="hljs-string">"""
Original parameter string
"""</span>
strToSign = <span class="hljs-string">'03146776612-14579579182016-03-14 20:18:38yb60becc49c9-8ce6-4b5d-b214-6614fbfd03f21'</span>

<span class="hljs-string">"""
CAUTION: The str before sign needs to be urlencoded first.
         using urllib.quote_plus instead of urllib.quote
"""</span>
encodedStr = quote_plus(strToSign)

<span class="hljs-string">"""
Place the PRIVATE key(openssl generated pem format key pair) in the right place.
"""</span>
priv_key = RSA.importKey(open(<span class="hljs-string">'pkcs8_rsa_private_key.pem'</span>, <span class="hljs-string">'r'</span>).read())

<span class="hljs-string">"""
SHA1 hash the str first then sign it using the private key.
"""</span>
signedStr = PKCS1_v1_5.new(priv_key).sign(SHA.new(encodedStr))

<span class="hljs-string">"""
Finally, convert the bytes to hex.
"""</span>
hexStr = hexlify(signedStr)

<span class="hljs-string">"""
You can load this python file and manage to produce the correct hexStr using these functions as a base. You can test againest with each function seperatedly to find out what goes wrong. Good luck!

"""</span>

</code></pre>
</div></section></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>